<div id="step5" class="steps container" style="padding-top:60px;padding-bottom:60px;display:none;">

  <section class="row">


    <!-- START OF LEFT SIDE PANEL -->
    <div class="col-md-8" style="padding-left:40px;padding-right:40px;">

      <!-- title that explains the step -->
      <div class="explain-step" style="padding-left:0px;">
        <h3 class="subtitle">What is Your Sales Goal?</h3>
          <i class="light" style="font-weight:300;">
            You have 7 days to sell this box. The more you sell, the better your margins!
          </i>
      </div>

      <!-- Goal slider starts here -->
      <div class="panel panel-default" style="padding:30px 40px;">
          <label for="basic-url">Sales Goal</label>

          <div style="padding:15px">
            <div id="rangeslider"></div>
          </div>

          <br><br>

          <div class="row">
            <div class="col-md-4">
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon3"># of boxes</span>
              <input id="goal_qty" type="text" class="form-control" ng-value="box.goal" aria-describedby="basic-addon3" onkeypress='return event.charCode >= 48 && event.charCode <= 57'>
            </div>
          </div>
          <div class="col-md-8">
            <div class="light" style="padding-left:80px;font-weight:400;color:#9d9d9d;">
              Your goal is the number of boxes you’re aiming to sell, but we’ll ship your beauty box as long as you sell at least 10!
            </div>
          </div>
          </div>

          <br>

          <label for="basic-url">Estimated Profit</label><br>
          <span style="font-size:40px;color:#25CB68;">{a ((box.price-box.cost)*box.goal) | currency:"$":0 a}+</span>

      </div>

      <!-- Goal slider starts here -->

        <div class="row">


            <div class="col-md-7">
              <div class="panel panel-default" style="padding:23px 5px 23px 25px;">
                <div class="row">
                  <div class="col-md-4">
                    <img  width="100%" src="../static/img/packaging/{a box.style.img a}">
                  </div>
                  <div class="col-md-8" style="padding-top:5px;">
                    <h4>{a box.brand_name a}</h4>
                    <i class="light">{a box.box_name a}</i>
                    <h6 class="light">{a box.price-box.cost | currency:"$":2 a} profit/sale</h6>
                  </div>
              </div>
            </div>
          </div>


            <div class="col-md-5">
              <div class="panel panel-default" style="padding:20px 20px 20px 20px;text-align:center !important;background-color:#FAFAFA;">
                <div class="row">
                  <label>Retail Price</label>
                  <p style="font-size:11px;font-weight:300;color:#9d9d9d;">this is how much your customer pays</p>
                  <input id="retail_price" type="text" class="form-control"
                         style="margin-top:10px;width:75px;margin: 0 auto;text-align:center;color:#25CB68;"
                         ng-value='box.price | currency:"$":2'>
                  <h6 class="light" style="font-size:10px;font-weight:400;">Fandemic recommends {a box.cost+5 | currency:"$":2 a}</h6>
              </div>
            </div>
          </div>

        </div>


    </div>


    <!--START OF RIGHT SIDE SUMMARY PANEL -->
    <div class="col-md-4">
      {% include('builder/summary.html') %}
      <button id="next-btn4" class="btn btn-primary btn-lg btn btn-primary btn-lg btn-nav
                  {% if cat == 'beauty' %}btn-beauty{% endif %} next-btn">NEXT STEP: Finish</button>
    </div>



 </section>

</div>

<script>
var slider = document.getElementById('rangeslider');

var range_all_sliders = {
	'min': [     10, 1 ],
	'30%': [   25,  1 ],
	'50%': [  50, 1 ],
  '70%': [  100, 1 ],
  '90%': [  400, 1 ],
	'max': [ 1000 ]
};

noUiSlider.create(slider, {
	start: 25,
  connect: [true, false],
  tooltips: wNumb({ decimals: 0 }),
  range: range_all_sliders,
  pips: {
		mode: 'range',
		density: 100
	},
  format: wNumb({
		decimals: 0
	})
});

//angular update goal function
function change(goal) {
    var appElement = document.querySelector('[ng-app=app]');
    var $scope = angular.element(appElement).scope();
    $scope = $scope.$$childHead; // add this and it will work
    $scope.$apply(function() {
        if (goal < 10){
          goal = 10;
        }
        else if (goal > 1000){
          goal = 1000;
        }
        $scope.box.goal = goal;
    });
}

//update when clicking off of goal input
$('#goal_qty').on('blur', function() {
    var goal = $(this).val();
    if (goal < 10){
      goal = 10;
    }
    else if (goal > 1000){
      goal = 1000;
    }
    slider.noUiSlider.set(goal);
    $('#goal_qty').val(goal);
    change(goal);
});

//update when hitting enter on goal input
$('#goal_qty').keyup(function(e){
    if(e.keyCode == 13)
    {
      var goal = $(this).val();
      if (goal < 10){
        goal = 10;
      }
      else if (goal > 1000){
        goal = 1000;
      }
      slider.noUiSlider.set(goal);
      $('#goal_qty').val(goal);
      change(goal);
    }
});

slider.noUiSlider.on('slide', function(){
	change(slider.noUiSlider.get());
  $('#goal_qty').val(slider.noUiSlider.get());
});

//console.log(slider.noUiSlider.get());

$('.noUi-tooltip').hide();

$( ".noUi-handle" ).hover(
  function() {
    $('.noUi-tooltip').show();
  }, function() {
    $('.noUi-tooltip').hide();
  }
);


//RETAIL PRICE JS

//angular update goal function
function change_retail_price(goal) {
    var appElement = document.querySelector('[ng-app=app]');
    var $scope = angular.element(appElement).scope();
    $scope = $scope.$$childHead; // add this and it will work
    $scope.$apply(function() {

        $scope.box.price = goal;
    });
}

//update when clicking off of goal input
$('#retail_price').on('blur', function() {
    var newPrice = $(this).val();
    newPrice = newPrice.replace('$',''); //if user includes $ sign

    if (isNumber(newPrice)){
      change_retail_price(newPrice);
      $('#retail_price').val('$'+parseFloat(newPrice).toFixed(2).toString());
    }

});

//update when hitting enter on goal input
$('#retail_price').keyup(function(e){
    if(e.keyCode == 13)
    {
      var newPrice = $(this).val();
      newPrice = newPrice.replace('$',''); //if user includes $ sign

      if (isNumber(newPrice)){
        change_retail_price(newPrice);
        $('#retail_price').val('$'+parseFloat(newPrice).toFixed(2).toString());
      }

    }
});

//function that validates number
function isNumber(n) {
  return !isNaN(parseFloat(n)) && isFinite(n);
}
</script>

<style>
.noUi-handle:hover {
  cursor: pointer;
}
</style>
